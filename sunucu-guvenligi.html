<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.22.3: https://docutils.sourceforge.io/" />
<title>&lt;string&gt;</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 9511 2024-01-13 09:50:07Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.
Despite the name, some widely supported CSS2 features are used.

See https://docutils.sourceforge.io/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: gray; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic, pre.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<p># Sunucu güvenliğinin sağlanması
Bu yazıda sunucunuzun güvenliğini nasıl arttırabiliriz onu anlatacağım.
Sunucuda debian kullandığınızı farzediyorum. Debian kullanmıyorsanız silip debiana geçin.</p>
<p>## Gereksiz paketlerin silinmesi
Öncelikle sunucu firmasının imajı bizim için hayırlamaka kullandığı fakat sonradan silmediği paketleri silelim.
<tt class="docutils literal">`bash
# kurulu listesinden gereksiz olan şeyleri bulalım.
$ apt list <span class="pre">--installed</span>
# silelim (sunucuya python veya x11 ile ilgili paketler olmaması lazım. <span class="pre">cloud-init</span> varsa mutlaka silin)
$ apt purge <span class="pre">--autoremove</span> python3* <span class="pre">cloud-init</span> <span class="pre">-yq</span>
`</tt></p>
<p>## Ssh ayarları
Ssh bağlantısı için öncelikle elinizde sadece root hesabı varsa yeni kullanıcı oluşturun ve root ile girişi kapatın.
<tt class="docutils literal">`bash
# tahmin etmesi zor kullanıcı adı kullanın
$ adduser pingu31
`</tt>
Şu ayarları /etc/ssh/sshd_config (veya .d olandan) değiştirin
<tt class="docutils literal">`bash
# portu 22 yapmayın.
Port 2231
# root girişi kapatın
PermitRootLogin no
# parolalı girişi kapatın (sadece ssh keyi ile giriş yapın)
# Bunu yapmadan önce sunucuya ssh keyinizi ekleyip önce test edin.
PasswordAuthentication no
# Pam kapatın (zaten parola ile doğrulama yapmadığımız için gerek yok)
UsePAM no
`</tt>
## sysctl ayarları
Sunucuyu tarayan botlara gözükmemek için ve sunucuyu daha sağlam hale getirmek için bazı değişiklikler yapmamız gerekmektedir.
/etc/sysctl.d/990-security.conf dosyasını aşağıdaki gibi doldurun.
<a href="#system-message-1"><span class="problematic" id="problematic-1">``</span></a>`
## eBPF hardening
kernel.unprivileged_bpf_disabled=1
net.core.bpf_jit_harden=2</p>
<div class="system-message" id="system-message-1">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 14); <em><a href="#problematic-1">backlink</a></em></p>
Inline literal start-string without end-string.</div>
<p>## better ASLR
kernel.randomize_va_space=2
vm.mmap_rnd_bits=32
vm.mmap_rnd_compat_bits=16</p>
<p>## fs hardening
fs.protected_hardlinks=1
fs.protected_symlinks=1
fs.protected_fifos=2
fs.protected_regular=2</p>
<p>## mmap
vm.max_map_count=1048576</p>
<p>## suid
fs.suid_dumpable=0</p>
<p>## network
net.ipv4.tcp_syncookies=1
net.ipv4.tcp_rfc1337=1
net.ipv4.conf.all.rp_filter=1
net.ipv4.conf.default.rp_filter=1
net.ipv4.icmp_echo_ignore_all=1
net.ipv6.icmp.echo_ignore_all=1
net.ipv4.icmp_ignore_bogus_error_responses=1
net.ipv4.tcp_timestamps=0
net.ipv4.ip_default_ttl=128
<tt class="docutils literal">`
Ayarları uygulamak için:
`</tt>
sysctl -p /etc/sysctl.d/990-security.conf
<a href="#system-message-2"><span class="problematic" id="problematic-2">``</span></a><a href="#system-message-3"><span class="problematic" id="problematic-3">`</span></a></p>
<div class="system-message" id="system-message-2">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 57); <em><a href="#problematic-2">backlink</a></em></p>
Inline literal start-string without end-string.</div>
<div class="system-message" id="system-message-3">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 57); <em><a href="#problematic-3">backlink</a></em></p>
Inline interpreted text or phrase reference start-string without end-string.</div>
<p>## Dosyaları şifreleme
Sunucu firmasının disk yedeğini alıp dosya sisteminden bilgi elde etmesini risk olarak görüp buna engel olmak istiyorsanız disk şifreleme kullanabilirsiniz.
Sunucuda luks kullanmak mümkün olmadığı için dosya tabanlı şifrelemeler işimize daha çok yarayacaktır.</p>
<p>Detaylı bilgi için: <a class="reference external" href="https://wiki.archlinux.org/title/Fscrypt">https://wiki.archlinux.org/title/Fscrypt</a></p>
<p>## Docker / Podman kullanın
Sunucuda her ne çalıştıracaksanız sunucuya doğrudan kurmak yerine docker veya podman ile kullanın.
Bu sayede oldu da uygulamaya sızıldı tam yetki alamamış olurlar.
Ayrıca yedek alması ve güncellemesi daha basit.</p>
<p>## Açık portları kontrol edin
Açık portları kontrol edin ve gerekli olmadığını düşündüğünüz şeyleri sonlandırın.
<tt class="docutils literal">`bash
ss <span class="pre">-tlpnu</span>
# veya
netstat <span class="pre">-tlpnu</span>
`</tt></p>
<p>## Sunucuda kerneli güncelleme
Sunucuyu normal şekilde yeniden başlatmak yerine <cite>kexec</cite> kullanın. Hem daha hızlı yeniden başlatılır hem de olası bootloader sorunlarını ortadan kaldırır.
<tt class="docutils literal">`
kexec <span class="pre">-l</span> <span class="pre">/boot/vmlinuz-xxx</span> <span class="pre">--initrd=/boot/initrd.img-xxx</span> <span class="pre">--reuse-cmdline</span>
kexec <span class="pre">-e</span>
`</tt></p>
<p>## Systemd kullanmayın
Systemd varsa silip sysvinit veya openrc kullanın.</p>
<ul class="simple">
<li>Bunun için [devuan](<a class="reference external" href="https://www.devuan.org/">https://www.devuan.org/</a>) depolarını da ekleyip sistemi devuana çevirebilirsiniz.</li>
<li>Alternatif olarak debian üzerine sysvinit ve openrc kurmak mümkündür. <a class="reference external" href="https://gist.github.com/sulincix/1aeeb6ff99ea14e1ff76afc301b25785">https://gist.github.com/sulincix/1aeeb6ff99ea14e1ff76afc301b25785</a></li>
</ul>
<p>## Brute force engelleme
fail2ban kullanın
<a href="#system-message-4"><span class="problematic" id="problematic-4">``</span></a>`
$ apt install fail2ban</p>
<div class="system-message" id="system-message-4">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 106); <em><a href="#problematic-4">backlink</a></em></p>
Inline literal start-string without end-string.</div>
<p><a href="#system-message-5"><span class="problematic" id="problematic-5">``</span></a><a href="#system-message-6"><span class="problematic" id="problematic-6">`</span></a></p>
<div class="system-message" id="system-message-5">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 111); <em><a href="#problematic-5">backlink</a></em></p>
Inline literal start-string without end-string.</div>
<div class="system-message" id="system-message-6">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 111); <em><a href="#problematic-6">backlink</a></em></p>
Inline interpreted text or phrase reference start-string without end-string.</div>
<p>Ayrıca <cite>iptables</cite> kullanmayı öğrenin.</p>
</div>
</body>
</html>
